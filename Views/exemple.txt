<?php
// -------------------------------
// Donn√©es simul√©es (normalement stock√©es en DB)
// -------------------------------
$annonces = [
    [
        "id" => 1,
        "titre" => "Veste en cuir",
        "categorie" => "Mode",
        "prix" => 45,
        "description" => "Veste homme taille M, tr√®s peu port√©e, parfait pour l'hiver.",
        "image" => "./images/valley.png"
    ],
    [
        "id" => 2,
        "titre" => "Chaussures Nike",
        "categorie" => "Mode",
        "prix" => 60,
        "description" => "Nike Air Max, taille 42, √©tat neuf, √† peine utilis√©es.",
        "image" => "https://via.placeholder.com/400x300?text=Chaussures"
    ],
    [
        "id" => 3,
        "titre" => "iPhone 12",
        "categorie" => "√âlectronique",
        "prix" => 500,
        "description" => "Tr√®s bon √©tat, 128 Go, vendu avec chargeur et bo√Æte.",
        "image" => "https://via.placeholder.com/400x300?text=iPhone"
    ],
    [
        "id" => 4,
        "titre" => "Sac √† main",
        "categorie" => "Accessoires",
        "prix" => 30,
        "description" => "Sac en cuir marron, style vintage, bonne capacit√©.",
        "image" => "/images/forest_sun.jpg"
    ],
];

// -------------------------------
// Filtrage (recherche + cat√©gorie)
// -------------------------------
$recherche = isset($_GET['q']) ? strtolower(trim($_GET['q'])) : "";
$categorie = isset($_GET['cat']) ? $_GET['cat'] : "";

$annonces_filtrees = array_filter($annonces, function ($a) use ($recherche, $categorie) {
    $ok = true;
    if ($recherche !== "") {
        $ok = (strpos(strtolower($a["titre"]), $recherche) !== false ||
               strpos(strtolower($a["description"]), $recherche) !== false);
    }
    if ($categorie !== "" && $categorie !== "all") {
        $ok = $ok && ($a["categorie"] === $categorie);
    }
    return $ok;
});

// -------------------------------
// D√©tail d‚Äôune annonce
// -------------------------------
$detail = null;
if (isset($_GET['id'])) {
    foreach ($annonces as $a) {
        if ($a["id"] == $_GET['id']) {
            $detail = $a;
            break;
        }
    }
}
?>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mini Marketplace</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- Header -->
<!-- Header avec menu -->
<nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm">
  <div class="container-fluid">
    <!-- Logo -->
    <a class="navbar-brand fw-bold" href="index.php">Mini Marketplace</a>

    <!-- Bouton hamburger (mobile) -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Liens du menu -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="index.php">üè† Accueil</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            üìÇ Cat√©gories
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="index.php?cat=Mode">Mode</a></li>
            <li><a class="dropdown-item" href="index.php?cat=√âlectronique">√âlectronique</a></li>
            <li><a class="dropdown-item" href="index.php?cat=Accessoires">Accessoires</a></li>
            <li><a class="dropdown-item" href="index.php">Toutes les cat√©gories</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">‚ù§Ô∏è Favoris</a>
        </li>
      </ul>

      <!-- Boutons √† droite -->
      <!-- <div class="d-flex">
        <a href="#" class="btn btn-outline-light me-2">Mon compte</a>
        <a href="#" class="btn btn-warning fw-bold">‚ûï D√©poser une annonce</a>
      </div> -->

      <!-- Sidebar -->
    


  </div>
    <!-- Switch mode sombre -->
<div class="form-check form-switch text-white ms-3">
  <input class="form-check-input" type="checkbox" id="darkModeSwitch">
  <label class="form-check-label" for="darkModeSwitch">üåô</label>
</div>

<script>
  const switchBtn = document.getElementById('darkModeSwitch');
  switchBtn.addEventListener('change', () => {
    document.body.classList.toggle('bg-dark');
    document.body.classList.toggle('text-white');
  });
</script>
<a href="#" class="btn btn-outline-light me-2">üí¨</a>

<!-- Bouton login -->
<a href="#" class="btn btn-block btn-light me-2" data-bs-toggle="modal" data-bs-target="#loginModal">üîë Connexion</a>

</nav>

<!-- <div id="carouselAnnonce" class="carousel slide">
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src= "/images/valley.png" class="d-block w-100">
    </div>
    <div class="carousel-item">
      <img src="https://via.placeholder.com/600x400?text=Photo+2" class="d-block w-100">
    </div>
    <div class="carousel-item">
      <img src="https://via.placeholder.com/600x400?text=Photo+3" class="d-block w-100">
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselAnnonce" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselAnnonce" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div> -->
<!-- Bouton -->
<button class="btn btn-block btn-primary" data-bs-toggle="modal" data-bs-target="#chatModal">üí¨ Contacter le vendeur</button>

<!-- Modal -->
<div class="modal fade" id="chatModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Chat avec le vendeur</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" style="height:300px; overflow-y:auto;">
        <div class="text-muted">[Vendeur] Bonjour, l‚Äôarticle est toujours dispo ‚úÖ</div>
      </div>
      <div class="modal-footer">
        <input type="text" class="form-control" placeholder="√âcrire un message...">
        <button class="btn btn-success">Envoyer</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal login -->
<div class="modal fade" id="loginModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Connexion utilisateur</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label>Email</label>
            <input type="email" class="form-control" placeholder="ex: user@mail.com">
          </div>
          <div class="mb-3">
            <label>Mot de passe</label>
            <input type="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <button type="submit" class="btn btn-success w-100">Se connecter</button>
          <div class="text-center mt-2">
            <a href="#">Cr√©er un compte</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Bouton d√©p√¥t -->
<a href="#" class="btn btn-block btn-outline-danger" data-bs-toggle="modal" data-bs-target="#sellModal">‚ûï Vendre un article</a>

<!-- Modal d√©p√¥t -->
<div class="modal fade" id="sellModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success">
        <h5 class="modal-title">D√©poser une annonce</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3"><label>Titre</label><input type="text" class="form-control"></div>
          <div class="mb-3"><label>Cat√©gorie</label>
            <select class="form-select">
              <option>Mode</option>
              <option>√âlectronique</option>
              <option>Accessoires</option>
            </select>
          </div>
          <div class="mb-3"><label>Prix (‚Ç¨)</label><input type="number" class="form-control"></div>
          <div class="mb-3"><label>Photos</label><input type="file" class="form-control" multiple></div>
          <div class="mb-3"><label>Description</label><textarea class="form-control"></textarea></div>
          <button type="submit" class="btn btn-success w-100">Publier</button>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="container mt-4">

<?php if ($detail): ?>
    <!-- Page d√©tail d‚Äôannonce -->
    <div class="card shadow-lg">
        <img src="<?= $detail['image'] ?>" class="card-img-top" alt="<?= htmlspecialchars($detail['titre']) ?>">
        <div class="card-body">
            <h3 class="card-title"><?= htmlspecialchars($detail['titre']) ?></h3>
            <span class="badge bg-primary"><?= $detail['categorie'] ?></span>
            <p class="card-text mt-3"><?= htmlspecialchars($detail['description']) ?></p>
            <h4 class="text-success fw-bold"><?= $detail['prix'] ?> ‚Ç¨</h4>
            <a href="index.php" class="btn btn-outline-secondary mt-3">‚¨Ö Retour aux annonces</a>
        </div>
    </div>

<?php else: ?>
    <!-- Barre de recherche et filtres -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-6">
            <input type="text" name="q" class="form-control" placeholder="Rechercher..." value="<?= htmlspecialchars($recherche) ?>">
        </div>
        <div class="col-md-4">
            <select name="cat" class="form-select">
                <option value="all">Toutes les cat√©gories</option>
                <option value="Mode" <?= $categorie=="Mode"?"selected":"" ?>>Mode</option>
                <option value="√âlectronique" <?= $categorie=="√âlectronique"?"selected":"" ?>>√âlectronique</option>
                <option value="Accessoires" <?= $categorie=="Accessoires"?"selected":"" ?>>Accessoires</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">Filtrer</button>
        </div>
    </form>

    <!-- Grille des annonces -->
    <div class="row">
        <?php if (empty($annonces_filtrees)): ?>
            <div class="col-12">
                <div class="alert alert-warning">Aucune annonce trouv√©e.</div>
            </div>
        <?php else: ?>
            <?php foreach ($annonces_filtrees as $a): ?>
                <div class="col-md-3 mb-4">
                    <div class="card h-100 shadow-sm">
                        <img src="<?= $a['image'] ?>" class="card-img-top" alt="<?= htmlspecialchars($a['titre']) ?>">
                        <div class="card-body">
                            <h5 class="card-title"><?= htmlspecialchars($a['titre']) ?></h5>
                            <div class="bg-teal color-palette">
                              <span><?= $a['categorie'] ?></span>
                            </div>
                            
                            <p class="card-text text-muted mt-2"><?= htmlspecialchars(substr($a['description'], 0, 50)) ?>...</p>
                            <h6 class="text-danger fw-bold"><?= $a['prix'] ?> ‚Ç¨</h6>
                            <a href="index.php?id=<?= $a['id'] ?>" class="btn btn-sm btn-primary mt-2">Voir l‚Äôannonce</a>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        <?php endif; ?>
    </div>
<?php endif; ?>
</div>
<!-- Hero d‚Äôaccueil -->
<div class="bg-success text-white text-center p-5 mb-4 rounded shadow-sm">
    <h1 class="fw-bold">Bienvenue sur Mini Marketplace üëã</h1>
    <p class="lead">Achetez et vendez facilement, trouvez la bonne affaire pr√®s de chez vous.</p>
    <a href="#" class="btn btn-light btn-lg mt-2">D√©poser une annonce</a>
</div>


<!-- Footer -->
<footer class="bg-dark text-white text-center py-3 mt-5">
    <p class="mb-0">¬© 2025 Mini Marketplace - Tous droits r√©serv√©s</p>
    <small>
        <a href="#" class="text-white me-3">√Ä propos</a>
        <a href="#" class="text-white me-3">Contact</a>
        <a href="#" class="text-white">Conditions</a>
    </small>
</footer>

<!-- style -->
<style>
  .btn.btn-block.btn-primary{
    margin-top: 10px;
    margin-left: 30px;

  }
  .btn.btn-block.btn-outline-danger{
    margin-top: 10px;
    margin-left: 30px;
  }
</style>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
